#
# zeller2011irop.R, 28 Mar 14
#
# Data from:
#
# Example from:
# Empirical Software Engineering using R
# Derek M. Jones

source("ESEUR_config.r")


eclipse2_0_ch=read.csv(paste0(ESEUR_dir, "regression/T/eclipse-metrics-files-2.0-chars.csv.xz"),
			sep=";", as.is=TRUE)

ecl_mod = glm((post>0) ~ ASCII_0+ASCII_1+ASCII_2+ASCII_3+ASCII_4+ASCII_5+ASCII_6+ASCII_7+ASCII_8+ASCII_9+ASCII_10+ASCII_11+ASCII_12+ASCII_13+ASCII_14+ASCII_15+ASCII_16+ASCII_17+ASCII_18+ASCII_19+ASCII_20+ASCII_21+ASCII_22+ASCII_23+ASCII_24+ASCII_25+ASCII_26+ASCII_27+ASCII_28+ASCII_29+ASCII_30+ASCII_31+ASCII_32+ASCII_33+ASCII_34+ASCII_35+ASCII_36+ASCII_37+ASCII_38+ASCII_39+ASCII_40+ASCII_41+ASCII_42+ASCII_43+ASCII_44+ASCII_45+ASCII_46+ASCII_47+ASCII_48+ASCII_49+ASCII_50+ASCII_51+ASCII_52+ASCII_53+ASCII_54+ASCII_55+ASCII_56+ASCII_57+ASCII_58+ASCII_59+ASCII_60+ASCII_61+ASCII_62+ASCII_63+ASCII_64+ASCII_65+ASCII_66+ASCII_67+ASCII_68+ASCII_69+ASCII_70+ASCII_71+ASCII_72+ASCII_73+ASCII_74+ASCII_75+ASCII_76+ASCII_77+ASCII_78+ASCII_79+ASCII_80+ASCII_81+ASCII_82+ASCII_83+ASCII_84+ASCII_85+ASCII_86+ASCII_87+ASCII_88+ASCII_89+ASCII_90+ASCII_91+ASCII_92+ASCII_93+ASCII_94+ASCII_95+ASCII_96+ASCII_97+ASCII_98+ASCII_99+ASCII_100+ASCII_101+ASCII_102+ASCII_103+ASCII_104+ASCII_105+ASCII_106+ASCII_107+ASCII_108+ASCII_109+ASCII_110+ASCII_111+ASCII_112+ASCII_113+ASCII_114+ASCII_115+ASCII_116+ASCII_117+ASCII_118+ASCII_119+ASCII_120+ASCII_121+ASCII_122+ASCII_123+ASCII_124+ASCII_125+ASCII_126+ASCII_127+ASCII_128+ASCII_129+ASCII_130+ASCII_131+ASCII_132+ASCII_133+ASCII_134+ASCII_135+ASCII_136+ASCII_137+ASCII_138+ASCII_139+ASCII_140+ASCII_141+ASCII_142+ASCII_143+ASCII_144+ASCII_145+ASCII_146+ASCII_147+ASCII_148+ASCII_149+ASCII_150+ASCII_151+ASCII_152+ASCII_153+ASCII_154+ASCII_155+ASCII_156+ASCII_157+ASCII_158+ASCII_159+ASCII_160+ASCII_161+ASCII_162+ASCII_163+ASCII_164+ASCII_165+ASCII_166+ASCII_167+ASCII_168+ASCII_169+ASCII_170+ASCII_171+ASCII_172+ASCII_173+ASCII_174+ASCII_175+ASCII_176+ASCII_177+ASCII_178+ASCII_179+ASCII_180+ASCII_181+ASCII_182+ASCII_183+ASCII_184+ASCII_185+ASCII_186+ASCII_187+ASCII_188+ASCII_189+ASCII_190+ASCII_191+ASCII_192+ASCII_193+ASCII_194+ASCII_195+ASCII_196+ASCII_197+ASCII_198+ASCII_199+ASCII_200+ASCII_201+ASCII_202+ASCII_203+ASCII_204+ASCII_205+ASCII_206+ASCII_207+ASCII_208+ASCII_209+ASCII_210+ASCII_211+ASCII_212+ASCII_213+ASCII_214+ASCII_215+ASCII_216+ASCII_217+ASCII_218+ASCII_219+ASCII_220+ASCII_221+ASCII_222+ASCII_223+ASCII_224+ASCII_225+ASCII_226+ASCII_227+ASCII_228+ASCII_229+ASCII_230+ASCII_231+ASCII_232+ASCII_233+ASCII_234+ASCII_235+ASCII_236+ASCII_237+ASCII_238+ASCII_239+ASCII_240+ASCII_241+ASCII_242+ASCII_243+ASCII_244+ASCII_245+ASCII_246+ASCII_247+ASCII_248+ASCII_249+ASCII_250+ASCII_251+ASCII_252+ASCII_253+ASCII_254+ASCII_255, data=eclipse2_0_ch, family = "binomial")

ecl_mod = glm((post>0) ~ ASCII_9+ASCII_10+ASCII_13+ASCII_24+ASCII_32+ASCII_34+ASCII_36+ASCII_37+ASCII_38+ASCII_40+ASCII_41+ASCII_42+ASCII_43+ASCII_45+ASCII_46+ASCII_47+ASCII_48+ASCII_49+ASCII_50+ASCII_52+ASCII_55+ASCII_58+ASCII_59+ASCII_61+ASCII_63+ASCII_65+ASCII_66+ASCII_67+ASCII_68+ASCII_70+ASCII_71+ASCII_72+ASCII_74+ASCII_75+ASCII_76+ASCII_77+ASCII_78+ASCII_79+ASCII_80+ASCII_82+ASCII_86+ASCII_87+ASCII_89+ASCII_90+ASCII_91+ASCII_92+ASCII_93+ASCII_95+ASCII_96+ASCII_97+ASCII_99+ASCII_100+ASCII_101+ASCII_102+ASCII_105+ASCII_106+ASCII_109+ASCII_112+ASCII_115+ASCII_116+ASCII_117+ASCII_120+ASCII_121+ASCII_122+ASCII_124+ASCII_126+ASCII_160, data=eclipse2_0_ch, family = "binomial")

min_ecl_mod=stepAIC(ecl_mod)


ecl_mod = glm((post > 0) ~ ASCII_10 + ASCII_13 + ASCII_32 + ASCII_34 + 
    ASCII_36 + ASCII_38 + ASCII_40 + ASCII_41 + ASCII_42 + ASCII_43 + 
    ASCII_45 + ASCII_46 + ASCII_47 + ASCII_48 + ASCII_49 + ASCII_50 + 
    ASCII_52 + ASCII_55 + ASCII_58 + ASCII_59 + ASCII_61 + ASCII_63 + 
    ASCII_65 + ASCII_66 + ASCII_67 + ASCII_68 + ASCII_71 + ASCII_72 + 
    ASCII_74 + ASCII_75 + ASCII_76 + ASCII_77 + ASCII_78 + ASCII_80 + 
    ASCII_82 + ASCII_87 + ASCII_89 + ASCII_90 + ASCII_91 + ASCII_92 + 
    ASCII_95 + ASCII_96 + ASCII_100 + ASCII_101 + ASCII_102 + 
    ASCII_105 + ASCII_109 + ASCII_112 + ASCII_115 + ASCII_117 + 
    ASCII_121 + ASCII_124 + ASCII_126 + ASCII_160, family = "binomial", 
    data = eclipse2_0_ch)

# 40 (  41 )  91 [  93 ]
# 51 ;

# 34 "  38 &  42 *  46 .  63 ?
# 71 G  74 J  78 N  89 Y
# 101 e  102 f  105 i  121 y
ecl_mod = glm((post > 0) ~ log(ASCII_32) + ASCII_34 + 
    ASCII_38 + ASCII_42 + 
    ASCII_46 + 
    ASCII_63 + 
    ASCII_71 + 
    ASCII_74 + ASCII_78 + 
    ASCII_89 + 
    ASCII_101 + ASCII_102 + 
    ASCII_105 + 
    ASCII_121 , family = "binomial", 
    data = eclipse2_0_ch)


# From distributed R file

# Step 0: Read the files

files_20 <- read.table("eclipse-metrics-files-2.0-chars.csv.xz", header=T, sep=";")
files_21 <- read.table("eclipse-metrics-files-2.1-chars.csv.xz", header=T, sep=";")
files_30 <- read.table("eclipse-metrics-files-3.0-chars.csv.xz", header=T, sep=";")



# Step 3: Run the classification experiments 

test_classification <- function (train, test) 
{
model.glm <- glm((post>0) ~ ASCII_0+ASCII_1+ASCII_2+ASCII_3+ASCII_4+ASCII_5+ASCII_6+ASCII_7+ASCII_8+ASCII_9+ASCII_10+ASCII_11+ASCII_12+ASCII_13+ASCII_14+ASCII_15+ASCII_16+ASCII_17+ASCII_18+ASCII_19+ASCII_20+ASCII_21+ASCII_22+ASCII_23+ASCII_24+ASCII_25+ASCII_26+ASCII_27+ASCII_28+ASCII_29+ASCII_30+ASCII_31+ASCII_32+ASCII_33+ASCII_34+ASCII_35+ASCII_36+ASCII_37+ASCII_38+ASCII_39+ASCII_40+ASCII_41+ASCII_42+ASCII_43+ASCII_44+ASCII_45+ASCII_46+ASCII_47+ASCII_48+ASCII_49+ASCII_50+ASCII_51+ASCII_52+ASCII_53+ASCII_54+ASCII_55+ASCII_56+ASCII_57+ASCII_58+ASCII_59+ASCII_60+ASCII_61+ASCII_62+ASCII_63+ASCII_64+ASCII_65+ASCII_66+ASCII_67+ASCII_68+ASCII_69+ASCII_70+ASCII_71+ASCII_72+ASCII_73+ASCII_74+ASCII_75+ASCII_76+ASCII_77+ASCII_78+ASCII_79+ASCII_80+ASCII_81+ASCII_82+ASCII_83+ASCII_84+ASCII_85+ASCII_86+ASCII_87+ASCII_88+ASCII_89+ASCII_90+ASCII_91+ASCII_92+ASCII_93+ASCII_94+ASCII_95+ASCII_96+ASCII_97+ASCII_98+ASCII_99+ASCII_100+ASCII_101+ASCII_102+ASCII_103+ASCII_104+ASCII_105+ASCII_106+ASCII_107+ASCII_108+ASCII_109+ASCII_110+ASCII_111+ASCII_112+ASCII_113+ASCII_114+ASCII_115+ASCII_116+ASCII_117+ASCII_118+ASCII_119+ASCII_120+ASCII_121+ASCII_122+ASCII_123+ASCII_124+ASCII_125+ASCII_126+ASCII_127+ASCII_128+ASCII_129+ASCII_130+ASCII_131+ASCII_132+ASCII_133+ASCII_134+ASCII_135+ASCII_136+ASCII_137+ASCII_138+ASCII_139+ASCII_140+ASCII_141+ASCII_142+ASCII_143+ASCII_144+ASCII_145+ASCII_146+ASCII_147+ASCII_148+ASCII_149+ASCII_150+ASCII_151+ASCII_152+ASCII_153+ASCII_154+ASCII_155+ASCII_156+ASCII_157+ASCII_158+ASCII_159+ASCII_160+ASCII_161+ASCII_162+ASCII_163+ASCII_164+ASCII_165+ASCII_166+ASCII_167+ASCII_168+ASCII_169+ASCII_170+ASCII_171+ASCII_172+ASCII_173+ASCII_174+ASCII_175+ASCII_176+ASCII_177+ASCII_178+ASCII_179+ASCII_180+ASCII_181+ASCII_182+ASCII_183+ASCII_184+ASCII_185+ASCII_186+ASCII_187+ASCII_188+ASCII_189+ASCII_190+ASCII_191+ASCII_192+ASCII_193+ASCII_194+ASCII_195+ASCII_196+ASCII_197+ASCII_198+ASCII_199+ASCII_200+ASCII_201+ASCII_202+ASCII_203+ASCII_204+ASCII_205+ASCII_206+ASCII_207+ASCII_208+ASCII_209+ASCII_210+ASCII_211+ASCII_212+ASCII_213+ASCII_214+ASCII_215+ASCII_216+ASCII_217+ASCII_218+ASCII_219+ASCII_220+ASCII_221+ASCII_222+ASCII_223+ASCII_224+ASCII_225+ASCII_226+ASCII_227+ASCII_228+ASCII_229+ASCII_230+ASCII_231+ASCII_232+ASCII_233+ASCII_234+ASCII_235+ASCII_236+ASCII_237+ASCII_238+ASCII_239+ASCII_240+ASCII_241+ASCII_242+ASCII_243+ASCII_244+ASCII_245+ASCII_246+ASCII_247+ASCII_248+ASCII_249+ASCII_250+ASCII_251+ASCII_252+ASCII_253+ASCII_254+ASCII_255, data=train, family = "binomial")
	test.prob <- predict(model.glm, test, type="response")
	test.pred <- test.prob>=0.50
	
	outcome <- table(factor(test$post>0, levels=c(F,T)), factor(test.pred, levels=c(F,T)))
	TN <- outcome[1,1]
	FN <- outcome[2,1]
	FP <- outcome[1,2]
	TP <- outcome[2,2]
	precision <- if (TP + FP ==0) { 1 } else { TP / (TP + FP) }
	recall <- TP / (TP + FN)
	accuracy <- (TP + TN) / (TN + FN + FP + TP)
	defects <- (TP + FN) / (TN + FN + FP + TP)
	return (c(defects, precision, recall, accuracy))
}


test_classification(files_20, files_20)
test_classification(files_20, files_21)
test_classification(files_20, files_30)
test_classification(files_21, files_20)
test_classification(files_21, files_21)
test_classification(files_21, files_30)
test_classification(files_30, files_20)
test_classification(files_30, files_21)
test_classification(files_30, files_30)


# Step 4: Run the ranking experiments

test_ranking <- function (train, test) 
{
	model.lm <- lm(post ~ ASCII_0+ASCII_1+ASCII_2+ASCII_3+ASCII_4+ASCII_5+ASCII_6+ASCII_7+ASCII_8+ASCII_9+ASCII_10+ASCII_11+ASCII_12+ASCII_13+ASCII_14+ASCII_15+ASCII_16+ASCII_17+ASCII_18+ASCII_19+ASCII_20+ASCII_21+ASCII_22+ASCII_23+ASCII_24+ASCII_25+ASCII_26+ASCII_27+ASCII_28+ASCII_29+ASCII_30+ASCII_31+ASCII_32+ASCII_33+ASCII_34+ASCII_35+ASCII_36+ASCII_37+ASCII_38+ASCII_39+ASCII_40+ASCII_41+ASCII_42+ASCII_43+ASCII_44+ASCII_45+ASCII_46+ASCII_47+ASCII_48+ASCII_49+ASCII_50+ASCII_51+ASCII_52+ASCII_53+ASCII_54+ASCII_55+ASCII_56+ASCII_57+ASCII_58+ASCII_59+ASCII_60+ASCII_61+ASCII_62+ASCII_63+ASCII_64+ASCII_65+ASCII_66+ASCII_67+ASCII_68+ASCII_69+ASCII_70+ASCII_71+ASCII_72+ASCII_73+ASCII_74+ASCII_75+ASCII_76+ASCII_77+ASCII_78+ASCII_79+ASCII_80+ASCII_81+ASCII_82+ASCII_83+ASCII_84+ASCII_85+ASCII_86+ASCII_87+ASCII_88+ASCII_89+ASCII_90+ASCII_91+ASCII_92+ASCII_93+ASCII_94+ASCII_95+ASCII_96+ASCII_97+ASCII_98+ASCII_99+ASCII_100+ASCII_101+ASCII_102+ASCII_103+ASCII_104+ASCII_105+ASCII_106+ASCII_107+ASCII_108+ASCII_109+ASCII_110+ASCII_111+ASCII_112+ASCII_113+ASCII_114+ASCII_115+ASCII_116+ASCII_117+ASCII_118+ASCII_119+ASCII_120+ASCII_121+ASCII_122+ASCII_123+ASCII_124+ASCII_125+ASCII_126+ASCII_127+ASCII_128+ASCII_129+ASCII_130+ASCII_131+ASCII_132+ASCII_133+ASCII_134+ASCII_135+ASCII_136+ASCII_137+ASCII_138+ASCII_139+ASCII_140+ASCII_141+ASCII_142+ASCII_143+ASCII_144+ASCII_145+ASCII_146+ASCII_147+ASCII_148+ASCII_149+ASCII_150+ASCII_151+ASCII_152+ASCII_153+ASCII_154+ASCII_155+ASCII_156+ASCII_157+ASCII_158+ASCII_159+ASCII_160+ASCII_161+ASCII_162+ASCII_163+ASCII_164+ASCII_165+ASCII_166+ASCII_167+ASCII_168+ASCII_169+ASCII_170+ASCII_171+ASCII_172+ASCII_173+ASCII_174+ASCII_175+ASCII_176+ASCII_177+ASCII_178+ASCII_179+ASCII_180+ASCII_181+ASCII_182+ASCII_183+ASCII_184+ASCII_185+ASCII_186+ASCII_187+ASCII_188+ASCII_189+ASCII_190+ASCII_191+ASCII_192+ASCII_193+ASCII_194+ASCII_195+ASCII_196+ASCII_197+ASCII_198+ASCII_199+ASCII_200+ASCII_201+ASCII_202+ASCII_203+ASCII_204+ASCII_205+ASCII_206+ASCII_207+ASCII_208+ASCII_209+ASCII_210+ASCII_211+ASCII_212+ASCII_213+ASCII_214+ASCII_215+ASCII_216+ASCII_217+ASCII_218+ASCII_219+ASCII_220+ASCII_221+ASCII_222+ASCII_223+ASCII_224+ASCII_225+ASCII_226+ASCII_227+ASCII_228+ASCII_229+ASCII_230+ASCII_231+ASCII_232+ASCII_233+ASCII_234+ASCII_235+ASCII_236+ASCII_237+ASCII_238+ASCII_239+ASCII_240+ASCII_241+ASCII_242+ASCII_243+ASCII_244+ASCII_245+ASCII_246+ASCII_247+ASCII_248+ASCII_249+ASCII_250+ASCII_251+ASCII_252+ASCII_253+ASCII_254+ASCII_255, data=train)
	test.pred <- predict(model.lm, test)
	
	r.squared <- summary(model.lm)$r.squared
	pearson <- cor(test$post, test.pred, method="pearson")
	spearman <- cor(test$post, test.pred, method="spearman")
	pearson.p <- cor.test(test$post, test.pred, method="pearson")$p.value
	spearman.p <- cor.test(test$post, test.pred, method="spearman", exact=FALSE)$p.value
	
	return (c(r.squared, pearson, spearman, pearson.p<0.01, spearman.p<0.01))
}


test_ranking(files_20, files_20)
test_ranking(files_20, files_21)
test_ranking(files_20, files_30)
test_ranking(files_21, files_20)
test_ranking(files_21, files_21)
test_ranking(files_21, files_30)
test_ranking(files_30, files_20)
test_ranking(files_30, files_21)
test_ranking(files_30, files_30)
