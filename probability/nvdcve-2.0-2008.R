#
# nvdcve-2.0-2008.R,  1 Jan 15
#
# Data from:
#
#
# Example from:
# Empirical Software Engineering using R
# Derek M. Jones

source("ESEUR_config.r")

library("plyr")
library("XNomial")


prod_month=function(prod_str)
{
all_prod=subset(nvd, grepl(prod_str, nvd$vuln.product))
t=months(all_prod$datetime)
t_tab=table(t)
t_len=length(t_tab)
t_12=c(as.vector(t_tab), rep(0, 12-t_len))

return(t_12)
}

# Ignores the fact that months are ordered.
# Circular statistics???

nvd=read.csv(paste0(ESEUR_dir, "probability/nvdcve-2.0-2012.csv.xz"), as.is=TRUE)

nvd$datetime=as.Date(nvd$vuln.published.datetime, format="%Y-%m-%d")

t1=nvd[grepl("windows_server_2008", nvd$vuln.product), ]

t1=nvd[grepl("firefox", nvd$vuln.product), ]
table(months(t1$datetime))

# Information about the product containing vulnerability is a colon
# delimited list.
t=strsplit(nvd$vuln.product, ":")

product_str=aaply(t, 1, function(df) c(df[3], df[4]))

moz_only=subset(product_str, grepl(".*mozilla.*", product_str[, 1]))
win_only=subset(product_str, grepl(".*microsoft.*", product_str[, 1]))

table(moz_only[,2])
table(win_only[,2])

ie_mon=prod_month("windows_vista")
ie_mon=prod_month("windows_server_2003")

# windows server 2008 not multinomial for 2009, 2010, 2013
ie_mon=prod_month("windows_server_2008")

# 2010, 2012, 2013 not multinomial if missing months 'filled' with zero
ie_mon=prod_month("internet_explorer")
ie_mon=prod_month("firefox")
ie_mon=prod_month("oracle")

m_test=xmonte(ie_mon, rep(1/length(ie_mon), length(ie_mon)), ntrials=1e+6)
m_test=xmonte(ie_mon, rep(1/length(ie_mon), length(ie_mon)), ntrials=1e+6, statName="Chisq")
m_test=xmulti(ie_mon, rep(1/length(ie_mon), length(ie_mon)))


